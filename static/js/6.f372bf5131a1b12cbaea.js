webpackJsonp([6],{GXNL:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("Gu7T"),a=r.n(o),l=r("woOf"),n=r.n(l),s=r("MVsr"),i=r("mMlH"),c=r("xT6B"),d=r("FWz8"),u={name:"addOrder",data:function(){return{listLoading:!1,updateLoading:!1,rules:{orderSn:[{required:!0,message:"请输入",trigger:"blur"}],customerName:[{required:!0,message:"请输入",trigger:"change"}],orderDate:[{required:!0,message:"请输入",trigger:"blur"}],orderOther:[{required:!1,message:"请输入",trigger:"blur"}]},order:{},defaultOrder:{orderSn:null,customerName:"",customerId:0,totalAmount:0,orderDate:0,orderOther:null,goodList:[]},customerOptions:[],stockOptions:[],stockSelect:[],stockSelectInfo:{firm:null,stock:null,model:null,price:null,num:0},dialogVisible:!1,isSaved:!1}},created:function(){this.handleResetAdd(),this.getCustomerList(),this.getStockList()},filters:{formatDateTime:function(e){if(null==e||""===e)return"N/A";var t=new Date(e);return Object(c.a)(t,"yyyy-MM-dd")}},methods:{handleResetAdd:function(){this.order=n()({},this.defaultOrder);var e=new Date;e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),this.order.orderDate=e.getTime(),this.order.goodList=[],this.isSaved=!1},handleAddOrder:function(e){var t=this;this.$refs[e].validate(function(e){e&&(t.updateLoading=!0,Object(d.a)(t.order).then(function(e){t.$message({message:"保存成功",type:"success",duration:1e3}),t.updateLoading=!1,t.dialogVisible=!1,t.isSaved=!0}).catch(function(){return t.updateLoading=!1}))})},getCustomerList:function(){var e=this;Object(i.d)().then(function(t){e.customerOptions=[];for(var r=t.data.list,o=0;o<r.length;o++)e.customerOptions.push({label:r[o].customerName,value:r[o].customerName,key:r[o].customerId})})},handleChangeCustomerName:function(e){var t=this;this.order.customerId=0,this.customerOptions.forEach(function(r){r.value!=e||(t.order.customerId=r.key)})},handleChangeStock:function(){this.stockSelectInfo.firm=this.stockSelect[0],this.stockSelectInfo.stock=this.stockSelect[1],this.stockSelectInfo.model=this.stockSelect[2],this.stockSelectInfo.price=this.$refs.cascaderSelect.getCheckedNodes()[0].data.price},getStockList:function(){var e=this;Object(s.c)({}).then(function(t){var r=t.data.list,o=[],l=[],n=[],s="",i="";r.length>0&&(s=r[0].firm,i=r[0].stock,r[0].model),r.forEach(function(e){i!=e.stock&&(l.push({label:i,value:i,children:[].concat(a()(n))}),n=[]),s!=e.firm&&(o.push({label:s,value:s,children:[].concat(a()(l))}),l=[]),n.push({label:e.model,value:e.model,num:e.num,unit:e.unit,price:e.price}),i=e.stock,s=e.firm,e.model}),l.push({label:i,value:i,children:[].concat(a()(n))}),o.push({label:s,value:s,children:[].concat(a()(l))}),e.stockOptions=[].concat(o)})},addGood:function(){this.order.goodList.push({firm:this.stockSelectInfo.firm,stock:this.stockSelectInfo.stock,model:this.stockSelectInfo.model,price:this.stockSelectInfo.price,num:parseInt(this.stockSelectInfo.num,10)}),this.order.totalAmount+=this.stockSelectInfo.price*this.stockSelectInfo.num},handleDeleteGood:function(e,t){this.order.goodList.splice(e,1),this.order.totalAmount-=t.price*t.num},handlePrintDialog:function(e){var t=this;this.$refs[e].validate(function(e){e&&(t.dialogVisible=!0)})}}},m={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container",staticStyle:{width:"80%",margin:"auto"}},[r("el-card",{staticClass:"operate-container",attrs:{shadow:"never"}},[r("i",{staticClass:"el-icon-tickets"}),e._v(" "),r("span",[e._v("订单信息")]),e._v(" "),r("span",{directives:[{name:"show",rawName:"v-show",value:e.isSaved,expression:"isSaved"}],staticStyle:{color:"red"}},[e._v("（已保存）")]),e._v(" "),r("el-button",{staticClass:"btn-add",staticStyle:{"margin-left":"20px"},attrs:{size:"mini",type:"danger"},on:{click:function(t){e.handleResetAdd()}}},[e._v("重置")]),e._v(" "),r("el-button",{staticClass:"btn-add",staticStyle:{"margin-left":"20px"},attrs:{size:"mini",loading:e.updateLoading,disabled:e.updateLoading},on:{click:function(t){e.handleAddOrder("orderInfoForm")}}},[e._v("保存")]),e._v(" "),r("el-button",{staticClass:"btn-add",staticStyle:{"margin-left":"20px"},attrs:{size:"mini",loading:e.updateLoading,disabled:e.updateLoading},on:{click:function(t){e.handlePrintDialog("orderInfoForm")}}},[e._v("打印")])],1),e._v(" "),r("div",{staticClass:"table-container"},[r("el-card",{staticStyle:{"margin-top":"15px"},attrs:{shadow:"never"}},[r("div",{attrs:{slot:"header"},slot:"header"},[r("svg-icon",{staticStyle:{color:"#606266"},attrs:{"icon-class":"marker"}}),e._v(" "),r("span",{staticClass:"font-small"},[e._v("基本信息")])],1),e._v(" "),r("el-form",{ref:"orderInfoForm",staticStyle:{width:"60%"},attrs:{model:e.order,rules:e.rules,"label-width":"20%",size:"small"}},[r("el-form-item",{attrs:{label:"订单号：",prop:"orderSn"}},[r("el-input",{model:{value:e.order.orderSn,callback:function(t){e.$set(e.order,"orderSn",t)},expression:"order.orderSn"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"购买方：",prop:"customerName"}},[r("el-select",{attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择购买方"},on:{change:e.handleChangeCustomerName},model:{value:e.order.customerName,callback:function(t){e.$set(e.order,"customerName",t)},expression:"order.customerName"}},e._l(e.customerOptions,function(e){return r("el-option",{key:e.key,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"日期：",prop:"orderDate"}},[r("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy 年 MM 月 dd 日","value-format":"timestamp"},model:{value:e.order.orderDate,callback:function(t){e.$set(e.order,"orderDate",t)},expression:"order.orderDate"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"备注：",prop:"orderOther"}},[r("el-input",{attrs:{type:"textarea",rows:3},model:{value:e.order.orderOther,callback:function(t){e.$set(e.order,"orderOther",t)},expression:"order.orderOther"}})],1)],1)],1),e._v(" "),r("el-card",{staticStyle:{"margin-top":"15px"},attrs:{shadow:"never"}},[r("div",{attrs:{slot:"header"},slot:"header"},[r("svg-icon",{staticStyle:{color:"#606266"},attrs:{"icon-class":"marker"}}),e._v(" "),r("span",{staticClass:"font-small"},[e._v("货品信息")]),e._v(" "),r("el-cascader",{ref:"cascaderSelect",staticStyle:{"margin-left":"20px",width:"30%"},attrs:{filterable:"",options:e.stockOptions,props:{expandTrigger:"hover"},prop:"stock"},on:{change:function(t){e.handleChangeStock()}},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.node,a=t.data;return[r("span",[e._v(e._s(a.label))]),e._v(" "),o.isLeaf?r("span",[e._v(" (剩余："+e._s(a.num+a.unit)+") ")]):e._e()]}}]),model:{value:e.stockSelect,callback:function(t){e.stockSelect=t},expression:"stockSelect"}}),e._v(" "),r("el-input-number",{staticStyle:{"margin-left":"20px",display:"inline-block",width:"20%"},model:{value:e.stockSelectInfo.num,callback:function(t){e.$set(e.stockSelectInfo,"num",t)},expression:"stockSelectInfo.num"}}),e._v(" "),r("el-button",{staticClass:"btn-add",staticStyle:{"margin-left":"20px"},attrs:{size:"mini",type:"primary",disabled:null==e.stockSelectInfo.firm||0==e.stockSelectInfo.num},on:{click:function(t){e.addGood()}}},[e._v("添加")])],1),e._v(" "),r("el-table",{ref:"orderItemTable",staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.order.goodList,border:""}},[r("el-table-column",{attrs:{label:"供货商",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.firm))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"货品名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.stock))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"规格型号",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.model))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"数量",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.num))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"单价",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.price))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"小计",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              ￥"+e._s(t.row.num*t.row.price)+"\n            ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){e.handleDeleteGood(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),r("div",{staticStyle:{float:"right",margin:"20px"}},[e._v("\n          合计："),r("span",{staticClass:"color-danger"},[e._v("￥"+e._s(e.order.totalAmount))])])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"订单预览",visible:e.dialogVisible,top:"10vh",width:"60%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-card",{ref:"orderCard",attrs:{shadow:"never",id:"orderCard"}},[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",{staticClass:"font-small"},[e._v("订单")])]),e._v(" "),r("el-form",{staticStyle:{width:"100%"},attrs:{model:e.order,"label-position":"left","label-width":"10%",size:"small"}},[r("el-form-item",{attrs:{label:"订单号：",prop:"orderSn"}},[r("el-row",[e._v(" "+e._s(e.order.orderSn)+" ")])],1),e._v(" "),r("el-form-item",{attrs:{label:"购买方：",prop:"customerName"}},[r("el-row",[e._v(" "+e._s(e.order.customerName)+" ")])],1),e._v(" "),r("el-form-item",{attrs:{label:"日期：",prop:"orderDate"}},[r("el-row",[e._v(" "+e._s(e._f("formatDateTime")(e.order.orderDate))+" ")])],1),e._v(" "),r("el-form-item",{attrs:{label:"备注：",prop:"orderOther"}},[r("el-row",[e._v(" "+e._s(e.order.orderOther)+" ")])],1)],1),e._v(" "),r("el-table",{ref:"orderItemTable",staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.order.goodList}},[r("el-table-column",{attrs:{label:"供货商",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.firm))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"货品名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.stock))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"规格型号",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.model))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"数量",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.num))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"单价",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.price))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"小计",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              ￥"+e._s(t.row.num*t.row.price)+"\n            ")]}}])})],1),e._v(" "),r("div",{staticStyle:{float:"right",margin:"20px"}},[e._v("\n          合计："),r("span",{staticClass:"color-danger"},[e._v("￥"+e._s(e.order.totalAmount))])])],1),e._v(" "),r("div",{staticStyle:{"text-align":"center","margin-top":"20px"}},[r("el-button",{directives:[{name:"print",rawName:"v-print",value:"#orderCard",expression:"'#orderCard'"}],attrs:{type:"primary",size:"medium"},on:{click:function(t){e.handleAddOrder("orderInfoForm")}}},[e._v("打印并保存")])],1)],1)],1)},staticRenderFns:[]};var f=r("VU/8")(u,m,!1,function(e){r("zc0W")},null,null);t.default=f.exports},zc0W:function(e,t){}});
//# sourceMappingURL=6.f372bf5131a1b12cbaea.js.map